# Makefile for processing Dia documents
# G. Baecker, Tecneos UG, 2018

# Should run on FreeBSD and Linux
.POSIX:

ALL_DIAGRAMS = contracts.dia lifecycle.dia
CONTRACTS_DIAGRAM = contracts.dia
CONTRACTS_SOL_DIR = autogenerated

ALL_PDFS = $(ALL_DIAGRAMS:.dia=.pdf)
ALL_SVGS = $(ALL_DIAGRAMS:.dia=.svg)

DIA = dia
DIA2SOL = tools/dia2sol.sh

.PHONY: help all pdf svg contracts clean
.SILENT:
.SUFFIXES: .dia .pdf .svg

help:
	echo "USAGE:"
	echo "    make help        # show this help"
	echo "    make all         # to create all of the following"
	echo "    make <name>.pdf  # to create a PDF from <name>.dia"
	echo "    make <name>.svg  # to create a SVG from <name>.dia"
	echo "    make pdf         # to create a PDF from every diagram"
	echo "    make svg         # to create a SVG from every diagram"
	echo "    make contracts   # to create Solidity contract stubs"
	echo "                       from the contracts diagram"
	echo "    make clean       # remove all created files"

all: pdf svg contracts

pdf: $(ALL_PDFS)
svg: $(ALL_SVGS)

contracts:
	$(DIA2SOL) "$(CONTRACTS_DIAGRAM)" "$(CONTRACTS_SOL_DIR)"

clean:
	rm -f *.svg *.pdf
	rm -rf "$(CONTRACTS_SOL_DIR)"

.dia.pdf:
	$(DIA) -e "$@" -t pdf "$?"

.dia.svg:
	$(DIA) -e "$@" -t cairo-svg "$?"
